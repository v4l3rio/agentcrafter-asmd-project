@startuml DSL Flow and Builder Pattern
!theme plain
title AgentCrafter DSL - Configuration Flow

actor User
participant "SimulationDSL" as DSL
participant "SimulationWrapper" as Wrapper
participant "SimulationBuilder" as SB
participant "AgentBuilder" as AB
participant "Properties" as Props
participant "WorldSpec" as World
participant "Runner" as Runner

User -> DSL : simulation { ... }
activate DSL

DSL -> Wrapper : create SimulationWrapper
activate Wrapper
DSL -> SB : new SimulationBuilder
activate SB

User -> DSL : grid: 10 x 10
DSL -> SB : grid(10, 10)

User -> DSL : agent: { ... }
DSL -> AB : new AgentBuilder
activate AB

User -> Props : Name >> "Agent1"
Props -> AB : setName("Agent1")

User -> Props : Start >> (0, 0)
Props -> AB : setStart(State(0, 0))

User -> DSL : withLearner: { ... }
DSL -> AB : withLearner()

User -> Props : Alpha >> 0.1
Props -> AB : setAlpha(0.1)

User -> Props : Gamma >> 0.9
Props -> AB : setGamma(0.9)

User -> DSL : onGoal: { ... }
DSL -> AB : onGoal()

User -> Props : Give >> 100
Props -> AB : addReward(100)

User -> Props : EndEpisode >> true
Props -> AB : addEndEpisode()

AB -> SB : addAgent(agentSpec)
deactivate AB

User -> DSL : walls: { ... }
DSL -> SB : addWalls()

User -> Props : Episodes >> 1000
Props -> SB : setEpisodes(1000)

User -> Props : WithGUI >> true
Props -> SB : withGUI(true)

DSL -> SB : build()
SB -> World : create WorldSpec
activate World
SB -> Runner : create and start
activate Runner

Runner -> Runner : execute simulation
deactivate Runner
deactivate World
deactivate SB
deactivate Wrapper
deactivate DSL

@enduml